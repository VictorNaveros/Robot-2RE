{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ROBOT 2R.E</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">
</head>
<body class="relative min-h-screen overflow-x-hidden">
    
    <!-- Fondo con imagen y overlay -->
    <div class="fixed inset-0 z-0">
        <!-- Imagen de fondo (placeholder - reemplazar despu√©s) -->
        <div class="absolute inset-0 bg-gradient-to-br from-gray-800 via-gray-900 to-black opacity-95"></div>
        <div class="absolute inset-0" style="background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=1600&q=80'); background-size: cover; background-position: center; opacity: 0.1;"></div>
        
        <!-- Formas geom√©tricas animadas -->
        <div class="absolute top-20 left-10 w-72 h-72 bg-green-500 rounded-full opacity-10 blur-3xl animate-pulse"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-blue-500 rounded-full opacity-10 blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    </div>

    <!-- Contenido -->
    <div class="relative z-10">
        
        <!-- Navbar -->
        <nav class="bg-white/95 backdrop-blur-sm shadow-lg sticky top-0 z-50">
            <div class="container mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-700 rounded-full flex items-center justify-center">
                            <span class="text-2xl">ü§ñ</span>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-800">Dashboard</h1>
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <a href="{% url 'home' %}" class="text-gray-600 hover:text-green-600 transition font-semibold hidden sm:block">
                            Inicio
                        </a>
                        <a href="{% url 'perfil' %}" class="flex items-center gap-2 text-gray-600 hover:text-green-600 transition font-semibold">
                            <span class="hidden sm:inline">{{ user.username }}</span>
                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                <span class="text-sm font-bold text-green-700">{{ user.first_name|first|upper }}</span>
                            </div>
                        </a>
                        <a href="{% url 'logout' %}" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition">
                            Salir
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container mx-auto px-6 py-8">
            
            <!-- Header de Bienvenida -->
            <div class="bg-gradient-to-r from-green-600 to-green-700 rounded-2xl shadow-2xl p-8 mb-8 text-white fade-in">
                <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                    <div>
                        <h2 class="text-3xl md:text-4xl font-bold mb-2">
                            ¬°Bienvenido, {{ user.first_name }}! üëã
                        </h2>
                        <p class="text-green-100 text-lg">
                            Panel de monitoreo del Robot 2R.E
                        </p>
                    </div>
                    
                    <div class="flex gap-4">
                        <div class="bg-white/20 backdrop-blur-sm px-6 py-4 rounded-xl text-center">
                            <div class="text-3xl mb-1">‚è±Ô∏è</div>
                            <div class="text-2xl font-bold" id="reloj">--:--</div>
                            <div class="text-xs text-green-100">Hora actual</div>
                        </div>
                        <div class="bg-white/20 backdrop-blur-sm px-6 py-4 rounded-xl text-center">
                            <div class="text-3xl mb-1">üìÖ</div>
                            <div class="text-lg font-bold" id="fecha">--/--/----</div>
                            <div class="text-xs text-green-100">Fecha</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estado del Robot (Destacado) -->
            <div class="mb-8 scroll-fade-in">
                <h3 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                    <span class="text-3xl">ü§ñ</span>
                    Estado del Robot
                </h3>
                
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 hover-scale">
                    <div class="grid md:grid-cols-2 gap-8">
                        
                        <!-- Estado Principal -->
                        <div class="text-center">
                            <div id="robot-icono" class="text-8xl mb-4 float">
                                {% if estado_robot %}
                                    {% if estado_robot.estado == 'activo' %}üü¢
                                    {% elif estado_robot.estado == 'error' %}üî¥
                                    {% elif estado_robot.estado == 'mantenimiento' %}üü°
                                    {% else %}‚ö´{% endif %}
                                {% else %}‚ö´{% endif %}
                            </div>
                            <h4 class="text-3xl font-bold mb-2 robot-texto
                                {% if estado_robot %}
                                    {% if estado_robot.estado == 'activo' %}text-green-600
                                    {% elif estado_robot.estado == 'error' %}text-red-600
                                    {% elif estado_robot.estado == 'mantenimiento' %}text-yellow-600
                                    {% else %}text-gray-600{% endif %}
                                {% else %}text-gray-600{% endif %}
                            ">
                                {{ estado_robot.get_estado_display|default:"Sin datos" }}
                            </h4>
                            <p class="text-gray-500 text-sm">Estado actual del robot</p>
                        </div>

                        <!-- Almacenamiento -->
<div>
    <div class="mb-6">
        <div class="flex justify-between items-center mb-2">
            <span class="text-gray-700 font-semibold">Almacenamiento</span>
            <span class="text-2xl font-bold robot-valor text-green-600">
                {% if estado_robot %}{{ estado_robot.almacenamiento_pct|floatformat:0 }}%{% else %}--{% endif %}
            </span>
        </div>
        
        <!-- Barra de progreso -->
        <div class="w-full bg-gray-200 rounded-full h-6 overflow-hidden">
            {% if estado_robot %}
                <div 
                    class="h-full transition-all duration-500 rounded-full flex items-center justify-end pr-2 text-white text-xs font-bold
                    {% if estado_robot.almacenamiento_pct >= 80 %}bg-red-500
                    {% elif estado_robot.almacenamiento_pct >= 50 %}bg-yellow-500
                    {% else %}bg-green-500{% endif %}"
                    
                >
                    {% if estado_robot.almacenamiento_pct > 10 %}
                        {{ estado_robot.almacenamiento_pct|floatformat:0 }}%
                    {% endif %}
                </div>
            {% else %}
                <div class="h-full bg-gray-400 w-0"></div>
            {% endif %}
        </div>
    </div>

    <!-- Info adicional -->
    <div class="space-y-3 bg-gray-50 p-4 rounded-lg">
        <div class="flex justify-between">
            <span class="text-gray-600">√öltima actualizaci√≥n:</span>
            <span class="font-semibold text-gray-800">
                {% if estado_robot %}{{ estado_robot.fecha_registro|date:"d/m/Y H:i" }}{% else %}--{% endif %}
            </span>
        </div>
        <div class="flex justify-between">
            <span class="text-gray-600">Jornada activa:</span>
            <span class="font-semibold text-gray-800">
                {% if jornada_activa %}
                    <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse mr-1"></span>
                    S√≠
                {% else %}
                    <span class="inline-block w-2 h-2 bg-gray-400 rounded-full mr-1"></span>
                    No
                {% endif %}
            </span>
        </div>
    </div>
</div>

                    </div>
                </div>
            </div>

            <!-- Sensores -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                    <span class="text-3xl">üì°</span>
                    Estado de Sensores
                </h3>

                <div class="grid md:grid-cols-3 gap-6">
                    
                    <!-- C√°mara -->
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-6 hover-scale scroll-fade-in">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-xl font-bold text-gray-800">C√°mara</h4>
                            <span id="sensor-camara" class="text-5xl sensor-valor">
                                {% if sensores %}
                                    {% if sensores.camara == 'ok' %}üì∑
                                    {% elif sensores.camara == 'error' %}‚ùå
                                    {% else %}‚ö†Ô∏è{% endif %}
                                {% else %}‚ùì{% endif %}
                            </span>
                        </div>
                        <p class="text-2xl font-bold mb-2 sensor-texto
                            {% if sensores %}
                                {% if sensores.camara == 'ok' %}text-green-600
                                {% elif sensores.camara == 'error' %}text-red-600
                                {% else %}text-gray-600{% endif %}
                            {% else %}text-gray-600{% endif %}
                        ">
                            {{ sensores.get_camara_display|default:"Sin datos" }}
                        </p>
                        <p class="text-sm text-gray-500">Reconocimiento de im√°genes</p>
                    </div>

                    <!-- Sensor Infrarrojo -->
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-6 hover-scale scroll-fade-in" style="animation-delay: 0.1s">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-xl font-bold text-gray-800">Infrarrojo</h4>
                            <span id="sensor-infrarrojo" class="text-5xl sensor-valor">
                                {% if sensores %}
                                    {% if sensores.s_infrarrojo == 'ok' %}üî¥
                                    {% elif sensores.s_infrarrojo == 'error' %}‚ùå
                                    {% else %}‚ö†Ô∏è{% endif %}
                                {% else %}‚ùì{% endif %}
                            </span>
                        </div>
                        <p class="text-2xl font-bold mb-2 sensor-texto
                            {% if sensores %}
                                {% if sensores.s_infrarrojo == 'ok' %}text-green-600
                                {% elif sensores.s_infrarrojo == 'error' %}text-red-600
                                {% else %}text-gray-600{% endif %}
                            {% else %}text-gray-600{% endif %}
                        ">
                            {{ sensores.get_s_infrarrojo_display|default:"Sin datos" }}
                        </p>
                        <p class="text-sm text-gray-500">Detecci√≥n de proximidad</p>
                    </div>

                    <!-- Sensor Ultras√≥nico -->
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-6 hover-scale scroll-fade-in" style="animation-delay: 0.2s">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-xl font-bold text-gray-800">Ultras√≥nico</h4>
                            <span id="sensor-ultrasonico" class="text-5xl sensor-valor">
                                {% if sensores %}
                                    {% if sensores.s_ultrasonico == 'ok' %}üì∂
                                    {% elif sensores.s_ultrasonico == 'error' %}‚ùå
                                    {% else %}‚ö†Ô∏è{% endif %}
                                {% else %}‚ùì{% endif %}
                            </span>
                        </div>
                        <p class="text-2xl font-bold mb-2 sensor-texto
                            {% if sensores %}
                                {% if sensores.s_ultrasonico == 'ok' %}text-green-600
                                {% elif sensores.s_ultrasonico == 'error' %}text-red-600
                                {% else %}text-gray-600{% endif %}
                            {% else %}text-gray-600{% endif %}
                        ">
                            {{ sensores.get_s_ultrasonico_display|default:"Sin datos" }}
                        </p>
                        <p class="text-sm text-gray-500">Medici√≥n de distancia</p>
                    </div>

                </div>
            </div>

            <!-- Gr√°fico de Actividad (Placeholder) -->
            <div class="mb-8 scroll-fade-in">
                <h3 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                    <span class="text-3xl">üìä</span>
                    Actividad Reciente
                </h3>
                
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8">
                    <canvas id="activityChart" height="80"></canvas>
                </div>
            </div>

        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Reloj en tiempo real
        function actualizarReloj() {
            const ahora = new Date();
            const horas = String(ahora.getHours()).padStart(2, '0');
            const minutos = String(ahora.getMinutes()).padStart(2, '0');
            const segundos = String(ahora.getSeconds()).padStart(2, '0');
            
            document.getElementById('reloj').textContent = `${horas}:${minutos}:${segundos}`;
            
            const dia = String(ahora.getDate()).padStart(2, '0');
            const mes = String(ahora.getMonth() + 1).padStart(2, '0');
            const anio = ahora.getFullYear();
            
            document.getElementById('fecha').textContent = `${dia}/${mes}/${anio}`;
        }
        
        setInterval(actualizarReloj, 1000);
        actualizarReloj();

        // Gr√°fico de actividad (placeholder con datos de ejemplo)
        const ctx = document.getElementById('activityChart').getContext('2d');
        const activityChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
                datasets: [{
                    label: 'Botellas Recicladas',
                    data: [12, 19, 15, 25, 22, 18, 20],
                    borderColor: 'rgb(16, 185, 129)',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 5
                        }
                    }
                }
            }
        });
    </script>
    <script src="{% static 'js/scroll-animations.js' %}"></script>
</body>
</html>